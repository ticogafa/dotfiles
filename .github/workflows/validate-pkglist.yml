name: Validate Package Lists

# Executa quando h√° mudan√ßas nas listas de pacotes
on:
  push:
    paths:
      - 'pkglist.txt'
      - 'aur_pkglist.txt'
  pull_request:
    paths:
      - 'pkglist.txt'
      - 'aur_pkglist.txt'

jobs:
  validate:
    name: Validar Listas de Pacotes
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Verifica duplicatas entre pkglist.txt e aur_pkglist.txt
      - name: Check for duplicates
        run: |
          echo "üîç Verificando pacotes duplicados..."
          duplicates=$(comm -12 <(sort pkglist.txt) <(sort aur_pkglist.txt))
          if [ -n "$duplicates" ]; then
            echo "‚ùå Pacotes duplicados encontrados:"
            echo "$duplicates"
            exit 1
          else
            echo "‚úÖ Nenhum pacote duplicado encontrado"
          fi

      # Verifica se os arquivos est√£o ordenados alfabeticamente
      - name: Check alphabetical order
        run: |
          echo "üîç Verificando ordem alfab√©tica..."
          
          # Verifica pkglist.txt
          if ! diff -q pkglist.txt <(sort pkglist.txt) > /dev/null; then
            echo "‚ö†Ô∏è  pkglist.txt n√£o est√° ordenado alfabeticamente"
            echo "Execute: sort -o pkglist.txt pkglist.txt"
          else
            echo "‚úÖ pkglist.txt est√° ordenado"
          fi
          
          # Verifica aur_pkglist.txt
          if ! diff -q aur_pkglist.txt <(sort aur_pkglist.txt) > /dev/null; then
            echo "‚ö†Ô∏è  aur_pkglist.txt n√£o est√° ordenado alfabeticamente"
            echo "Execute: sort -o aur_pkglist.txt aur_pkglist.txt"
          else
            echo "‚úÖ aur_pkglist.txt est√° ordenado"
          fi

      # Verifica linhas vazias
      - name: Check for empty lines
        run: |
          echo "üîç Verificando linhas vazias..."
          
          if grep -q '^$' pkglist.txt; then
            echo "‚ö†Ô∏è  pkglist.txt cont√©m linhas vazias"
          fi
          
          if grep -q '^$' aur_pkglist.txt; then
            echo "‚ö†Ô∏è  aur_pkglist.txt cont√©m linhas vazias"
          fi
          
          echo "‚úÖ Verifica√ß√£o conclu√≠da"

      # Conta total de pacotes
      - name: Count packages
        run: |
          echo "üìä Estat√≠sticas de pacotes:"
          echo "- Pacotes oficiais: $(wc -l < pkglist.txt)"
          echo "- Pacotes AUR: $(wc -l < aur_pkglist.txt)"
          echo "- Total: $(($(wc -l < pkglist.txt) + $(wc -l < aur_pkglist.txt)))"
