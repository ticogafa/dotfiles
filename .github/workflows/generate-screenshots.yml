name: Generate Preview

# Workflow para gerar previews e documenta칞칚o autom치tica
on:
  workflow_dispatch:  # Permite execu칞칚o manual
  push:
    branches: [ main ]
    paths:
      - '.config/waybar/**'
      - '.config/hypr/**'
      - 'screenshots/**'

jobs:
  update-readme:
    name: Atualizar README com Estat칤sticas
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Gera estat칤sticas do reposit칩rio
      - name: Generate statistics
        run: |
          echo "游늵 Gerando estat칤sticas..."
          
          # Conta scripts
          SCRIPT_COUNT=$(find .config -name "*.sh" | wc -l)
          
          # Conta pacotes
          PKG_COUNT=$(wc -l < pkglist.txt)
          AUR_COUNT=$(wc -l < aur_pkglist.txt)
          TOTAL_PKG=$((PKG_COUNT + AUR_COUNT))
          
          # Conta linhas de c칩digo
          TOTAL_LINES=$(find .config -name "*.sh" -o -name "*.lua" -o -name "*.fish" | xargs wc -l | tail -1 | awk '{print $1}')
          
          echo "::notice::Scripts: $SCRIPT_COUNT"
          echo "::notice::Pacotes: $TOTAL_PKG"
          echo "::notice::Linhas de c칩digo: $TOTAL_LINES"
          
          # Salva em arquivo
          cat > STATS.md << EOF
          # 游늵 Estat칤sticas do Reposit칩rio
          
          - 游닇 Scripts Shell: **$SCRIPT_COUNT**
          - 游닍 Pacotes Oficiais: **$PKG_COUNT**
          - 游댢 Pacotes AUR: **$AUR_COUNT**
          - 游 Total de Pacotes: **$TOTAL_PKG**
          - 游늯 Linhas de C칩digo: **$TOTAL_LINES**
          
          *Atualizado automaticamente em $(date)*
          EOF

      # Commit das mudan칞as (se houver)
      - name: Commit statistics
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          if [ -n "$(git status --porcelain)" ]; then
            git add STATS.md
            git commit -m "docs: update repository statistics [skip ci]"
            git push
          else
            echo "Nenhuma mudan칞a para commit"
          fi
